[travis]: https://travis-ci.org/Answart/next-store
[MIT]: https://github.com/Answart/next-store/blob/master/LICENSE.md
<!-- [coveralls]: https://coveralls.io/github/Answart/next-store -->

<!-- <p align="center">
  <img src="https://user-images.githubusercontent.com/4269260/51296194-c117d500-19cf-11e9-81a8-c0b15867579f.png" width="450" title="Home Page">
</p> -->

# Next Store

[![Build Status](https://travis-ci.org/Answart/next-store.svg)][travis]
[![MIT](https://img.shields.io/github/license/Answart/next-store.svg)][MIT]
<!-- [![Coverage Status](https://coveralls.io/repos/github/Answart/next-store/badge.svg)][coveralls] -->

:construction: WORK IN PROGRESS :construction:

A React e-commerce app where a user can browse among items with which they can buy or sell. It uses React's Next.js framework and GraphQL's Apollo framework.

User stories
------------

* As an unauthenticated or authenticated user, I can see and search for items in store.
* As an unauthenticated user, I can create an account or sign in.
* As an unauthenticated user, I can request to reset my account password.
* As an authenticated user, I can reset my account password.
* As an authenticated user, I can submit items I want to sell through the store.
* As an authenticated user, I can edit details, such as title and description, of a submitted item.
* As an authenticated user, I can add selections to a submitted item.
* As an authenticated user, I can edit details, such as price and quantity, of a submitted item's selection.
* As an authenticated user, I can delete an item I have submitted to the store.
* As an authenticated user, I can add/remove items from cart and come back later to access them.
* As an authenticated user, I can delete items from cart that I decide I don't want anymore.
* As an authenticated user, I can use a credit card to buy items in cart.
* As an authenticated user, I can view past orders.

Tech Stack and Key Packages
---------------------------

### Server Side

* [GraphQL](https://graphql.org/): Query language for APIs
* [GraphQL Yoga](https://oss.prisma.io/content/graphql-yoga/01-overview/): Express GraphQL server
* [Prisma](https://www.prisma.io/): GraphQL database interface
* [Bcryptjs](https://github.com/dcodeIO/bcrypt.js/): Password hashing
* [JSON Web Token](https://www.jsonwebtoken.io/): User authentication
* [MailTrap](https://mailtrap.io/): Development emailing
* [Postmark](https://postmarkapp.com/): Production emailing
* [nodemailer](https://nodemailer.com/about/): Sending email with NodeJS
* [Stripe](https://stripe.com/): E-commerce API

### Client Side

* [React](https://reactjs.org/): Javascript Framework
* [Next.js](https://nextjs.org/): React Framework for server side rendering/routing/tooling
* [Apollo](https://www.apollographql.com/): GraphQL Framework for Data Management
* [Styled-Components](https://www.styled-components.com/): CSS for styling React component systems
* [Jest](https://facebook.github.io/jest/): Javascript testing
* [Enzyme](https://github.com/airbnb/enzyme): React testing utility
* [Cloudinary](https://cloudinary.com/): Image hosting API

App Map
-------

```
├──server/
│   ├──.env                Server side environment variables
│   ├──.graphqlconfig.yml  GraphQL config file
│   ├──prisma.yml          Prisma config file
│   ├──datamodel.prisma    Type definitions for server querying generated by prisma
│   └──src/
│       ├──server.js             GraphQL Yoga server
│       ├──db.js                 Prisma DB connection and querying
│       ├──index.js              Server root which starts node server
│       ├──mail.js               Mailtrap integration through nodemailer and Email Templates
│       ├──schema.graphql        GraphQL yoga schema with type definitions for client facing calls
│       ├──stripe.js             Stripe API connection
│       ├──utils.js              Utility files
│       ├──generated/            Generated files from Prisma
│       │   └──prisma.graphql          Generated Prisma schema type definitions
│       └──resolvers/            Files for how server works with incoming/outgoing data
│           ├──Mutation.js             Config file for updating server data
│           └──Query.js                Config file for receiving server data
└──client/
    ├──config.js           Client side config
    ├──jest.setup.js       File setup React Jest and to configure Enzyme into Jest
    ├──__test__/           Test files for pages and components
    ├──static/             Assets like logo, fonts, or extra css
    ├──lib/                Files for utility and testing
    │   ├──cloudinary.js         Cloudinary API calls
    │   ├──utils.js              Utility methods
    │   └──withApollo.js         Apollo client setup
    ├──graphql/            Client side graphql query/mutations
    ├──components/         Component files called by pages and styles folder
    │   └──styles/               CSS for components using the styled-components package
    └──pages/              App page files
        ├──_app.js               App root for navigating pages and persisting state between page changes
        ├──_document.js          File to implement server side rendering for css-in-js libraries
        ├──buy.js                Product page
        ├──index.js              Home page
        ├──order.js              Order page
        ├──orders.js             Order history page
        ├──permissions.js        User permissions page
        ├──reset.js              Reset User password page
        ├──sell.js               Create Product page
        ├──shop.js               Products catalog page
        ├──signup.js             User signup/login page
        └──product/
            ├──edit.js               Update Product page
            ├──selections.js         Update Product's Variants page
            └──add.js                Update Product with new Variant page
```

Getting Started
---------------

Create an **.env** file in **server** directory that has the following:
```bash
# ./server/.env
NODE_ENV=development
APP_SECRET=<SECRETSTRINGOFYOURCHOICE>
PORT=4242
CLIENT_URL=http://localhost:7272
CLOUDINARY_API_KEY=<CLOUDINARYAPIKEY>
CLOUDINARY_PRESET=nextstore
CLOUDINARY_SECRET=<CLOUDINARYSECRETSTRING>
PRISMA_ENDPOINT=https://us1.prisma.sh/<WORKSPACENAME>/<SERVICENAME>/<STAGE>
PRISMA_SECRET=<SECRETPRISMASTRINGOFYOURCHOICE>
STRIPE_SECRET=<STRIPESECRETSTRING>
MAILTRAP_HOST=<MAILTRAPHOSTNAME>
MAILTRAP_PORT=<MAILTRAPPORTNUMBER>
MAILTRAP_USER=<MAILTRAPUSER>
MAILTRAP_PASS=<MAILTRAPPASSWORD>
POSTMARK_HOST=<POSTMARKHOSTNAME>
POSTMARK_PORT=<POSTMARKPORTNUMBER>
POSTMARK_USER=<POSTMARKUSER>
POSTMARK_PASS=<POSTMARKPASSWORD>
```

Start server:
```bash
# ./
$ cd server
# ./server/
$ npm install

# Initialize Prisma in server directory
$ prisma init

# Update .env file with given PRISMA_ENDPOINT then deploy prisma
$ prisma deploy

# Start the app locally by running the server and client side apps
$ npm run start:dev
```

Launch client in new tab:
```bash
# ./
$ cd client
# ./client/
$ npm install
$ npm run start:dev
```

View app at [**localhost:7272**](http://localhost:7272) in browser.

App Screenshots
---------------

<p align="center">
  <img src="https://user-images.githubusercontent.com/4269260/51296194-c117d500-19cf-11e9-81a8-c0b15867579f.png" width="350"  height="350" title="Home Page">
  <img src="https://user-images.githubusercontent.com/4269260/51296228-f8868180-19cf-11e9-8fd1-ba959d155792.png" width="350" height="350" alt="Account Page">
  <img src="https://user-images.githubusercontent.com/4269260/51295802-29fe4d80-19ce-11e9-93b2-e70788d3ddcc.png" width="350" height="350" alt="Vote Popup">
  <img src="https://user-images.githubusercontent.com/4269260/51295814-413d3b00-19ce-11e9-9e38-089a9254e7af.png" width="350" height="350" alt="Poll Page">
</p>

NPM Commands for Client and Server directories
------------

| Command | Description |
|---------|-------------|
| npm install | Install dependencies |
| npm run start:dev | Launch app |
